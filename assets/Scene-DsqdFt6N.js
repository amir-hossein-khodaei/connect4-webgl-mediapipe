import{a as M,j as e,S as H,b,F as j,C as G,M as E,d as k,T as L,I as T,e as N,H as $,f as R,g as P,h as F,A as _,P as O,E as U,i as q,L as Y,w as V,k as X,q as J}from"./three-Bs3MLzTg.js";import{a as c,R as K}from"./react-BwVFrCCm.js";import{u as m}from"./index-CGK66tSG.js";import"./mediapipe-SP_W-jUr.js";const Q=()=>{const a=c.useRef();return M(o=>{a.current&&(a.current.rotation.y=o.clock.getElapsedTime()*.01)}),e.jsxs("group",{children:[e.jsx(H,{distance:45e4,sunPosition:[100,20,100],inclination:.6,azimuth:.1,rayleigh:.5,turbidity:10,exposure:.5}),e.jsx("color",{attach:"background",args:["#87CEEB"]}),e.jsx("fog",{attach:"fog",args:["#87CEEB",30,90]}),e.jsx("ambientLight",{intensity:1.5,color:"#ccccff"}),e.jsx("directionalLight",{position:[10,20,10],intensity:2.5,castShadow:!0,"shadow-mapSize":[2048,2048],"shadow-bias":-1e-4,children:e.jsx("orthographicCamera",{attach:"shadow-camera",args:[-20,20,20,-20]})}),e.jsx(b,{count:300,scale:30,size:4,speed:.4,opacity:.5,color:"#ffffff"}),e.jsxs("group",{ref:a,children:[e.jsx(j,{speed:1,rotationIntensity:.1,floatIntensity:1,children:e.jsx("group",{position:[-40,10,-60],scale:10,children:e.jsx(G,{opacity:.5,speed:.2,width:20,depth:5,segments:20,color:"#ffffff"})})}),e.jsx(j,{speed:1.2,rotationIntensity:.1,floatIntensity:1,children:e.jsx("group",{position:[50,5,-50],scale:12,children:e.jsx(G,{opacity:.5,speed:.2,width:20,depth:5,segments:20,color:"#eefeff"})})}),e.jsx(j,{speed:.8,rotationIntensity:.05,floatIntensity:.5,children:e.jsx("group",{position:[0,50,-80],scale:15,children:e.jsx(G,{opacity:.4,speed:.1,width:30,depth:5,segments:30,color:"#ffffff"})})})]})]})},Z=()=>{const a=c.useRef(),o=c.useMemo(()=>Array.from({length:40}).map((t,s)=>{const i=s/40*Math.PI*2,n=15+Math.random()*2;return{x:Math.cos(i)*n,y:(Math.random()-.5)*1,z:Math.sin(i)*n,scale:.7+Math.random()*.7,rotation:[Math.random()*Math.PI,Math.random()*Math.PI,0]}}),[]),r=c.useMemo(()=>Array.from({length:20}).map((t,s)=>({x:(Math.random()<.5?-1:1)*(18+Math.random()*10),y:Math.random()*10-5,z:(Math.random()-.5)*20,scale:1+Math.random()*2,speed:.2+Math.random()*.5,rotation:[Math.random()*Math.PI,Math.random()*Math.PI,0]})),[]);return M((t,s)=>{a.current&&(a.current.rotation.y-=s*.05)}),e.jsx("group",{position:[0,-.6,-3],children:e.jsxs(j,{speed:1.5,rotationIntensity:.05,floatIntensity:.5,floatingRange:[-.2,.2],children:[e.jsxs("mesh",{receiveShadow:!0,position:[0,-4.5,0],children:[e.jsx("cylinderGeometry",{args:[11,8,.6,32]}),e.jsx("meshStandardMaterial",{color:"#f0f0f0",roughness:.1,metalness:.1})]}),e.jsxs("mesh",{position:[0,-4.2,0],rotation:[Math.PI/2,0,0],children:[e.jsx("torusGeometry",{args:[10.5,.15,16,64]}),e.jsx("meshStandardMaterial",{color:"#ffd700",emissive:"#ffd700",emissiveIntensity:.2,metalness:.8,roughness:.1})]}),e.jsxs("group",{position:[0,-5.5,0],children:[" ",e.jsxs("mesh",{position:[0,-4,0],children:[e.jsx("coneGeometry",{args:[10,10,7]}),e.jsx(E,{color:"#25262b",roughness:1,metalness:.1,distort:.3,speed:.2,flatShading:!0})]}),e.jsxs("mesh",{position:[6,-3,0],rotation:[0,0,.5],children:[e.jsx("dodecahedronGeometry",{args:[5,0]}),e.jsx("meshStandardMaterial",{color:"#222222",roughness:1,flatShading:!0})]}),e.jsxs("mesh",{position:[-6,-4,2],rotation:[0,0,-.5],children:[e.jsx("dodecahedronGeometry",{args:[6,0]}),e.jsx("meshStandardMaterial",{color:"#222222",roughness:1,flatShading:!0})]}),e.jsxs("mesh",{position:[0,-5,-6],rotation:[.5,0,0],children:[e.jsx("dodecahedronGeometry",{args:[5,0]}),e.jsx("meshStandardMaterial",{color:"#222222",roughness:1,flatShading:!0})]})]}),e.jsxs("group",{ref:a,position:[0,-6,0],children:[" ",o.map((t,s)=>e.jsxs("mesh",{position:[t.x,t.y,t.z],rotation:t.rotation,scale:t.scale,castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[1,0]}),e.jsx("meshStandardMaterial",{color:"#4a4a4a",roughness:.9,flatShading:!0})]},`ring-${s}`))]}),r.map((t,s)=>e.jsx(W,{position:[t.x,t.y,t.z],scale:t.scale,speed:t.speed,rotation:t.rotation},`scatter-${s}`))]})})},W=({position:a,scale:o,speed:r,rotation:t})=>e.jsx(j,{speed:r,rotationIntensity:1.5,floatIntensity:1.5,position:a,children:e.jsxs("mesh",{rotation:t,scale:o,castShadow:!0,receiveShadow:!0,children:[e.jsx("dodecahedronGeometry",{args:[1,0]}),e.jsx("meshStandardMaterial",{color:"#3a3a3a",roughness:1,flatShading:!0})]})}),ee=({position:a,type:o,isWinningPiece:r,...t})=>{const s=c.useRef(),i=a[1],n=8,h=c.useRef({y:n,velocity:0,gravity:-40,bounce:.2,settled:!1});M((v,u)=>{if(!s.current||h.current.settled)return;const l=h.current;l.velocity+=l.gravity*u,l.y+=l.velocity*u,l.y<=i&&(l.y=i,Math.abs(l.velocity)>.5?l.velocity=-l.velocity*l.bounce:(l.velocity=0,l.y=i,l.settled=!0)),s.current.position.set(a[0],l.y,0),o==="fire"?s.current.rotation.y+=u*2:(s.current.rotation.x+=u*.5,s.current.rotation.z+=u*.5),r&&(s.current.rotation.y+=u*10,s.current.rotation.x+=u*5)});const d=r?"#ffffff":o==="fire"?"#ff4500":"#00ffff",f=r?"#ffdd00":o==="fire"?"#ff0000":"#0088ff",g=r?5:o==="fire"?2:1.5;return e.jsxs("group",{ref:s,position:[a[0],n,0],...t,children:[e.jsxs("mesh",{castShadow:!0,children:[o==="fire"?e.jsx("sphereGeometry",{args:[.45,32,24]}):e.jsx("icosahedronGeometry",{args:[.45,1]}),o==="fire"||r?e.jsx(E,{color:d,emissive:f,emissiveIntensity:g,roughness:r?0:.4,metalness:r?1:.1,distort:.4,speed:r?10:3}):e.jsx("meshStandardMaterial",{color:d,emissive:f,emissiveIntensity:g,roughness:.2,metalness:.8})]}),e.jsx(b,{count:r?100:25,scale:r?2.5:1.4,size:r?5:o==="fire"?2:3,speed:r?2:.4,opacity:1,color:r?"#ffdd00":o==="fire"?"#ffff00":"#ffffff"})]})},w=6,S=7,p=1.2,x=S*p,se=w*p,y=new k({color:"#dbd9d0",roughness:.1,metalness:.1}),C=new k({color:"#ffcc00",roughness:.3,metalness:1,emissive:"#ffaa00",emissiveIntensity:.3}),A=c.memo(({position:a})=>e.jsxs("group",{position:a,children:[e.jsx("mesh",{position:[0,-4.2,0],castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("boxGeometry",{args:[2,1.8,2]})}),e.jsx("mesh",{position:[0,-3.2,0],material:C,children:e.jsx("cylinderGeometry",{args:[.9,1.2,.4,32]})}),e.jsx("mesh",{position:[0,.5,0],castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("cylinderGeometry",{args:[.8,.8,7.5,32]})}),e.jsx("mesh",{position:[0,4.4,0],material:C,children:e.jsx("cylinderGeometry",{args:[1.2,.9,.4,32]})}),e.jsx("mesh",{position:[0,5,0],castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("boxGeometry",{args:[1.8,1.2,1.8]})})]})),te=c.memo(()=>e.jsx(j,{speed:1.5,rotationIntensity:.02,floatIntensity:.2,children:e.jsxs("group",{position:[0,5.2,0],children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("boxGeometry",{args:[x+5,1.4,1.2]})}),e.jsx("mesh",{position:[0,-.6,.65],material:C,children:e.jsx("boxGeometry",{args:[x+3,.3,.1]})}),e.jsxs("mesh",{position:[0,0,.6],rotation:[0,0,Math.PI/4],children:[e.jsx("boxGeometry",{args:[1.8,1.8,.4]}),e.jsx("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1.5,toneMapped:!1})]})]})})),re=c.memo(()=>e.jsxs("group",{position:[0,-4.5,0],children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("boxGeometry",{args:[x+4,1.5,2]})}),e.jsx("mesh",{position:[0,1,0],castShadow:!0,receiveShadow:!0,material:y,children:e.jsx("boxGeometry",{args:[x+1,.8,1.5]})}),e.jsx("mesh",{position:[0,1.41,0],material:C,children:e.jsx("boxGeometry",{args:[x,.1,.8]})})]})),oe=()=>{const a=m(s=>s.hoverColumn),o=c.useMemo(()=>new L(.55,.06,16,32),[]),r=c.useMemo(()=>new k({color:"#ffcc00",emissive:"#ffaa00",emissiveIntensity:.8,roughness:.4,metalness:.8}),[]),t=[];for(let s=0;s<w;s++)for(let i=0;i<S;i++){const n=(i-(S-1)/2)*p,h=(s-(w-1)/2)*p+.5,d=i===a;t.push(e.jsx(N,{position:[n,h,0],scale:d?1.15:1,color:d?"#ffffff":"#ffcc00"},`${s}-${i}`))}return e.jsx(T,{range:42,material:r,geometry:o,children:t})},ne=()=>{const a=m(t=>t.board),o=m(t=>t.winningLine),r=(t,s)=>{const i=(s-(S-1)/2)*p,n=(t-(w-1)/2)*p+.5;return[i,n,0]};return e.jsx("group",{children:a.map((t,s)=>t.map((i,n)=>{if(i===0)return null;const h=r(s,n),d=i===1,f=o?.some(([g,v])=>g===s&&v===n);return e.jsx(ee,{position:[h[0],h[1],0],type:d?"fire":"ice",isWinningPiece:f},`piece-${s}-${n}`)}))})},ae=()=>{const a=m(n=>n.inputMode),o=m(n=>n.gameStatus),r=m(n=>n.setHoverColumn),t=m(n=>n.playMove),s=m(n=>n.hoverColumn),i=n=>{if(a!=="mouse"||o!=="playing")return;n.stopPropagation();const d=n.point.x/p+(S-1)/2,f=Math.max(0,Math.min(6,Math.round(d)));f!==m.getState().hoverColumn&&r(f)};return e.jsx("mesh",{visible:!1,position:[0,.5,1],scale:[1.2,1.2,1],onPointerMove:i,onClick:()=>a==="mouse"&&t(s),children:e.jsx("planeGeometry",{args:[x+1,se+1]})})},ie=()=>e.jsxs("group",{children:[e.jsx(A,{position:[-4.2-1.5,0,0]}),e.jsx(A,{position:[x/2+1.5,0,0]}),e.jsx(te,{}),e.jsx(re,{}),e.jsx(ae,{}),e.jsx(oe,{}),e.jsx(ne,{})]}),ce=1.2,le=7,de=()=>{const{hoverColumn:a,currentPlayer:o,gameStatus:r,inputMode:t,isAiming:s}=m(),i=c.useRef(),n=c.useRef(),h=c.useRef(),d=c.useRef(),f=c.useRef({scale:0,rotationSpeed:0});M((v,u)=>{if(!i.current)return;const l=(a-(le-1)/2)*ce;i.current.position.x=R.lerp(i.current.position.x,l,u*10);const z=v.clock.getElapsedTime();i.current.position.y=6+Math.sin(z*2.5)*.15;const B=s?.9:0,D=s?6:.5;if(f.current.scale=R.lerp(f.current.scale,B,u*5),f.current.rotationSpeed=R.lerp(f.current.rotationSpeed,D,u*2),h.current&&(h.current.scale.setScalar(f.current.scale),h.current.rotation.x+=u*.5,h.current.rotation.y+=u*1.5),d.current){d.current.rotation.z-=u*f.current.rotationSpeed,d.current.rotation.x=Math.sin(z*.5)*.15;const I=1+f.current.scale*.3;d.current.scale.setScalar(I)}if(n.current){const I=Math.random()*.5;n.current.intensity=(s?5:0)+I,n.current.color.set(s?"#ffaa00":"#ff4400")}});const g=r==="playing"&&o===1;return e.jsxs("group",{ref:i,position:[0,6,0],visible:g,children:[e.jsx("pointLight",{ref:n,distance:6,decay:2,color:"#ffaa00"}),e.jsxs("mesh",{ref:h,children:[e.jsx("sphereGeometry",{args:[.6,32,32]}),e.jsx(E,{color:"#ff4500",emissive:"#ffaa00",emissiveIntensity:1.5,roughness:0,metalness:.2,distort:.5,speed:3})]}),e.jsxs("group",{ref:d,rotation:[Math.PI/2,0,0],children:[e.jsxs("mesh",{children:[e.jsx("torusGeometry",{args:[.9,.03,16,64]}),e.jsx("meshBasicMaterial",{color:"#ffd700",transparent:!0,opacity:.6})]}),e.jsxs("mesh",{rotation:[0,0,Math.PI/3],children:[e.jsx("torusGeometry",{args:[.7,.02,16,64]}),e.jsx("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.5})]})]}),s&&e.jsxs("group",{children:[e.jsx(b,{count:30,scale:1,size:4,speed:.2,opacity:1,color:"#ffffff"}),e.jsx(b,{count:60,scale:2.5,size:3,speed:-1.5,opacity:.6,color:"#ffaa00",noise:.5})]}),e.jsxs("mesh",{position:[0,-3,0],children:[e.jsx("cylinderGeometry",{args:[.03,.03,6,8]}),e.jsx("meshBasicMaterial",{color:"#ffaa00",transparent:!0,opacity:s?.3:.05})]}),t==="hand"&&e.jsx($,{position:[0,1.4,0],center:!0,transform:!0,sprite:!0,children:e.jsx("div",{style:{color:s?"#ffffff":"#ffaa00",fontFamily:"Cinzel, serif",fontWeight:"bold",fontSize:"12px",textShadow:"0 0 8px rgba(0,0,0,0.8)",whiteSpace:"nowrap",letterSpacing:"2px",opacity:s?1:.6,pointerEvents:"none"},children:s?"⚡ RELEASE":"✊ CHARGE"})})]})},fe=()=>{const{currentPlayer:a,winner:o}=m(),r=c.useRef(new P("#ffddaa")),t=c.useRef(new P("#ffddaa"));return c.useEffect(()=>{o?o===1?r.current.set("#ffaa00"):o===2?r.current.set("#0000ff"):r.current.set("#888888"):a===1?r.current.set("#ffddaa"):r.current.set("#88ccff")},[a,o]),M((s,i)=>{t.current.lerp(r.current,i*2),s.scene.background&&s.scene.background.isColor&&s.scene.background.lerp(t.current,i*2),s.scene.fog&&s.scene.fog.color&&s.scene.fog.color.lerp(t.current,i*2)}),null};class he extends K.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,r){console.error("3D Context Error:",o,r)}render(){return this.state.hasError?e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-[#0a1a2a] text-center p-8",children:e.jsxs("div",{className:"border border-red-500/50 bg-red-900/20 p-6 rounded-lg max-w-lg",children:[e.jsx("h2",{className:"text-[#ffd700] text-xl font-bold mb-2",children:"The Scrying Glass is Broken"}),e.jsx("p",{className:"text-red-300 text-sm mb-4",children:"A graphical error prevented the world from loading."}),e.jsx("p",{className:"text-xs text-gray-400 font-mono bg-black/50 p-2 rounded mb-4",children:this.state.error?.message}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 border border-[#aaccff] text-[#aaccff] hover:bg-[#aaccff]/10 uppercase text-xs tracking-widest",children:"Reload Ritual"})]})}):this.props.children}}const ge=()=>e.jsx("div",{style:{width:"100vw",height:"100vh",background:"#87CEEB"},children:e.jsx(he,{children:e.jsx(F,{shadows:!0,dpr:[1,1.5],gl:{antialias:!1,toneMapping:_,toneMappingExposure:.6,powerPreference:"high-performance"},children:e.jsxs(c.Suspense,{fallback:null,children:[e.jsx(O,{makeDefault:!0,position:[0,-.14,15],fov:67,rotation:[-.15,0,0]}),e.jsx(Q,{}),e.jsx("color",{attach:"background",args:["#87CEEB"]}),e.jsx(U,{files:"/connect4-3d-hand/assets/venice_sunset_1k.hdr",blur:.8,background:!1}),e.jsx(fe,{}),e.jsxs("group",{position:[0,-.5,0],children:[e.jsx(ie,{}),e.jsx(Z,{}),e.jsx(de,{})]}),e.jsxs(q,{disableNormalPass:!0,multisampling:0,children:[e.jsx(Y,{}),e.jsx(V,{luminanceThreshold:1.1,mipmapBlur:!0,intensity:.4,radius:.5}),e.jsx(X,{opacity:.02}),e.jsx(J,{eskil:!1,offset:.1,darkness:.4})]})]})})})});export{ge as default};
